(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2164],{285:(e,s,r)=>{"use strict";r.d(s,{$:()=>o,r:()=>d});var t=r(5155),a=r(2115),n=r(4253),i=r(2085),l=r(9434);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,s)=>{let{className:r,variant:a,size:i,asChild:o=!1,...c}=e,u=o?n.DX:"button";return(0,t.jsx)(u,{className:(0,l.cn)(d({variant:a,size:i,className:r})),ref:s,...c})});o.displayName="Button"},1394:(e,s,r)=>{"use strict";r.d(s,{BK:()=>d,eu:()=>l,q5:()=>o});var t=r(5155),a=r(2115),n=r(5977),i=r(9434);let l=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(n.bL,{ref:s,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...a})});l.displayName=n.bL.displayName;let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(n._V,{ref:s,className:(0,i.cn)("aspect-square h-full w-full",r),...a})});d.displayName=n._V.displayName;let o=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(n.H4,{ref:s,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...a})});o.displayName=n.H4.displayName},2523:(e,s,r)=>{"use strict";r.d(s,{p:()=>i});var t=r(5155),a=r(2115),n=r(9434);let i=a.forwardRef((e,s)=>{let{className:r,type:a,...i}=e;return(0,t.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...i})});i.displayName="Input"},6104:(e,s,r)=>{"use strict";r.d(s,{IG:()=>c,db:()=>o,hJ:()=>u,j2:()=>d,sm:()=>f,yA:()=>l});var t=r(3915),a=r(3004),n=r(5317),i=r(858);let l=(0,t.Dk)().length?(0,t.Sx)():(0,t.Wp)({projectId:"yrdly-coyig",appId:"1:166095077947:web:2f5285213610bbd893521e",storageBucket:"yrdly-coyig.firebasestorage.app",apiKey:"AIzaSyCOE_L6g9c3J6jhcajVzNkC4flEao4Av2I",authDomain:"yrdly-coyig.firebaseapp.com",measurementId:"",messagingSenderId:"166095077947"}),d=(0,a.xI)(l),o=(0,n.aU)(l),c=(0,i.c7)(l),u=new a.HF,f=new a.LD("apple.com")},6424:(e,s,r)=>{"use strict";r.d(s,{F:()=>l});var t=r(5155),a=r(2115),n=r(7655),i=r(9434);let l=a.forwardRef((e,s)=>{let{className:r,children:a,...l}=e;return(0,t.jsxs)(n.bL,{className:(0,i.cn)("relative overflow-hidden",r),...l,children:[(0,t.jsx)(n.LM,{ref:s,className:"h-full w-full rounded-[inherit]",children:a}),(0,t.jsx)(d,{}),(0,t.jsx)(n.OK,{})]})});l.displayName=n.bL.displayName;let d=a.forwardRef((e,s)=>{let{className:r,orientation:a="vertical",...l}=e;return(0,t.jsx)(n.VM,{ref:s,orientation:a,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...l,children:(0,t.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.VM.displayName},6695:(e,s,r)=>{"use strict";r.d(s,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>l,wL:()=>u});var t=r(5155),a=r(2115),n=r(9434);let i=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});i.displayName="Card";let l=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});d.displayName="CardTitle";let o=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent";let u=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},6779:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>I});var t=r(5155),a=r(2115),n=r(1394),i=r(285),l=r(6695),d=r(2523),o=r(6424),c=r(9434),u=r(286),f=r(5074),m=r(2543),x=r(7687),p=r(8539),h=r(5317),g=r(6104),v=r(6874),b=r.n(v);function j(e){let{title:s="Find your neighbors",description:r="It looks like you haven't started any conversations yet. Once you do, they'll appear here.",buttonText:a="Find Neighbors",buttonLink:n="/neighbors"}=e;return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground p-4 text-center bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[(0,t.jsx)("div",{className:"mb-4 rounded-full bg-primary/10 p-4",children:(0,t.jsx)(u.A,{className:"h-10 w-10 text-primary"})}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-foreground mb-1",children:s}),(0,t.jsx)("p",{className:"mb-4 max-w-sm",children:r}),(0,t.jsx)(i.$,{asChild:!0,children:(0,t.jsx)(b(),{href:n,children:a})})]})}function y(e){let{conversations:s,currentUser:r}=e,[u,v]=(0,a.useState)(s),[b,y]=(0,a.useState)(null),[N,w]=(0,a.useState)([]),[k,I]=(0,a.useState)(""),E=(0,a.useRef)(null);(0,a.useEffect)(()=>{v(s)},[s]),(0,a.useEffect)(()=>{if(!(null==b?void 0:b.id)||!(null==r?void 0:r.id))return;let e=(0,h.P)((0,h.rJ)(g.db,"conversations",b.id,"messages"),(0,h.My)("timestamp","asc")),s=(0,h.aQ)(e,async e=>{w(await Promise.all(e.docs.map(async e=>{var s;let t,a=e.data();if(a.senderId===r.id)t=r;else if(a.senderId===b.participant.id)t=b.participant;else{let e=await (0,h.x7)((0,h.H9)(g.db,"users",a.senderId));t=e.exists()?{id:e.id,...e.data()}:{id:a.senderId,uid:a.senderId,name:"Unknown",avatarUrl:""}}return{id:e.id,senderId:a.senderId,text:a.text,sender:t,timestamp:(null==(s=a.timestamp)?void 0:s.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))||"...",read:a.read}})))});return()=>s()},[null==b?void 0:b.id,null==r?void 0:r.id]),(0,a.useEffect)(()=>{E.current&&(E.current.scrollTop=E.current.scrollHeight)},[N]);let S=async e=>{if(e.preventDefault(),""===k.trim()||!b)return;let s=(0,h.H9)(g.db,"conversations",b.id),t=(0,h.rJ)(s,"messages");try{await (0,h.c4)(g.db,async e=>{await (0,h.gS)(t,{senderId:r.id,text:k,timestamp:(0,h.O5)(),read:!1}),e.update(s,{lastMessage:{text:k,senderId:r.id,timestamp:(0,h.O5)(),read:!1}})}),I("")}catch(e){console.error("Error sending message: ",e)}};return(0,t.jsxs)(l.Zp,{className:"h-[calc(100vh-10rem)] w-full flex overflow-hidden",children:[(0,t.jsxs)("div",{className:(0,c.cn)("w-full md:w-1/3 border-r transition-transform duration-300 ease-in-out flex flex-col","md:translate-x-0",b?"-translate-x-full":"translate-x-0"),children:[(0,t.jsxs)("div",{className:"p-4 border-b",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Messages"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(f.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(d.p,{placeholder:"Search messages",className:"pl-8"})]})]}),(0,t.jsx)(o.F,{className:"flex-1",children:u.length>0?u.map(e=>{var s;return(0,t.jsxs)("div",{className:(0,c.cn)("flex items-center gap-4 p-4 cursor-pointer hover:bg-muted/50",(null==b?void 0:b.id)===e.id&&"bg-muted/50"),onClick:()=>y(e),children:[(0,t.jsxs)(n.eu,{children:[(0,t.jsx)(n.BK,{src:e.participant.avatarUrl,alt:e.participant.name}),(0,t.jsx)(n.q5,{children:e.participant.name.charAt(0)})]}),(0,t.jsxs)("div",{className:"flex-1 truncate",children:[(0,t.jsx)("p",{className:"font-semibold",children:e.participant.name}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:null==(s=e.messages[e.messages.length-1])?void 0:s.text})]})]},e.id)}):(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(j,{title:"No conversations",description:"You don't have any messages yet. Start a conversation with a friend!",buttonText:"Find Friends",buttonLink:"/neighbors"})})})]}),(0,t.jsx)("div",{className:(0,c.cn)("w-full md:w-2/3 flex flex-col absolute md:static inset-0 transition-transform duration-300 ease-in-out bg-background","md:translate-x-0",b?"translate-x-0":"translate-x-full"),children:b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 p-3 border-b",children:[(0,t.jsx)(i.$,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>y(null),children:(0,t.jsx)(m.A,{className:"h-5 w-5"})}),(0,t.jsxs)(n.eu,{children:[(0,t.jsx)(n.BK,{src:b.participant.avatarUrl,alt:b.participant.name}),(0,t.jsx)(n.q5,{children:b.participant.name.charAt(0)})]}),(0,t.jsx)("p",{className:"font-semibold",children:b.participant.name})]}),(0,t.jsx)(o.F,{ref:E,className:"flex-1 p-4 bg-gray-50 dark:bg-gray-900",children:(0,t.jsx)("div",{className:"space-y-4",children:N.map(e=>(0,t.jsxs)("div",{className:(0,c.cn)("flex gap-3",e.sender.id===r.id?"justify-end":"justify-start"),children:[e.sender.id!==r.id&&(0,t.jsxs)(n.eu,{className:"h-8 w-8",children:[(0,t.jsx)(n.BK,{src:e.sender.avatarUrl}),(0,t.jsx)(n.q5,{children:e.sender.name.charAt(0)})]}),(0,t.jsxs)("div",{className:(0,c.cn)("rounded-lg px-4 py-2 max-w-xs lg:max-w-md break-words",e.sender.id===r.id?"bg-primary text-primary-foreground":"bg-card border"),children:[(0,t.jsx)("p",{children:e.text}),(0,t.jsx)("p",{className:(0,c.cn)("text-xs opacity-70 mt-1",e.sender.id===r.id?"text-right":"text-left"),children:e.timestamp})]})]},e.id))})}),(0,t.jsx)("div",{className:"p-4 border-t bg-card",children:(0,t.jsxs)("form",{onSubmit:S,className:"flex items-center gap-2",children:[(0,t.jsx)(p.T,{placeholder:"Type a message...",value:k,onChange:e=>I(e.target.value),className:"flex-1 resize-none",rows:1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S(e))}}),(0,t.jsx)(i.$,{type:"submit",size:"icon",disabled:!k.trim(),children:(0,t.jsx)(x.A,{className:"h-5 w-5"})})]})})]}):(0,t.jsx)("div",{className:"hidden md:flex flex-1 items-center justify-center text-muted-foreground p-8",children:(0,t.jsx)(j,{title:"Select a conversation",description:"Choose one of your existing conversations to see the messages.",buttonText:"Find Friends",buttonLink:"/neighbors"})})})]})}var N=r(8030),w=r(8856);let k=()=>(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(w.E,{className:"h-12 w-12 rounded-full"}),(0,t.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,t.jsx)(w.E,{className:"h-4 w-3/4"}),(0,t.jsx)(w.E,{className:"h-4 w-1/2"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(w.E,{className:"h-12 w-12 rounded-full"}),(0,t.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,t.jsx)(w.E,{className:"h-4 w-3/4"}),(0,t.jsx)(w.E,{className:"h-4 w-1/2"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(w.E,{className:"h-12 w-12 rounded-full"}),(0,t.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,t.jsx)(w.E,{className:"h-4 w-3/4"}),(0,t.jsx)(w.E,{className:"h-4 w-1/2"})]})]})]});function I(){let{user:e,userDetails:s}=(0,N.A)(),[r,n]=(0,a.useState)([]),[i,l]=(0,a.useState)(!0),d=(0,a.useMemo)(()=>e?{id:e.uid,uid:e.uid,name:e.displayName||"Anonymous",avatarUrl:e.photoURL||"https://placehold.co/100x100.png"}:null,[e]);return((0,a.useEffect)(()=>{if(!e||!s)return void l(!1);if(!s.friends||0===s.friends.length){n([]),l(!1);return}let r=s.friends.map(e=>e.uid),t=(0,h.P)((0,h.rJ)(g.db,"conversations"),(0,h._M)("participantIds","array-contains",e.uid)),a=(0,h.aQ)(t,async s=>{let t=s.docs.map(async s=>{var t;let a=s.data(),n=a.participantIds.find(s=>s!==e.uid);if(!n||!r.includes(n))return null;let i=await (0,h.x7)((0,h.H9)(g.db,"users",n));if(!i.exists())return null;let l={id:i.id,...i.data()},o=a.lastMessage;return{id:s.id,participant:l,messages:o?[{id:"last",senderId:o.senderId,sender:o.senderId===(null==d?void 0:d.id)?d:l,text:o.text,timestamp:(null==(t=o.timestamp)?void 0:t.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))||"...",read:o.read}]:[]}});n((await Promise.all(t)).filter(Boolean)),l(!1)});return()=>a()},[e,s,d]),i)?(0,t.jsx)(k,{}):d&&(null==s?void 0:s.friends)&&0!==s.friends.length?(0,t.jsx)(y,{conversations:r,currentUser:d}):(0,t.jsx)(j,{title:"No Friends Yet",description:"You haven't added any friends yet. Find neighbors and send them a friend request to start chatting!",buttonText:"Find Neighbors",buttonLink:"/neighbors"})}},8030:(e,s,r)=>{"use strict";r.d(s,{A:()=>c,AuthProvider:()=>o});var t=r(5155),a=r(2115),n=r(3004),i=r(6104),l=r(5317);let d=(0,a.createContext)({user:null,userDetails:null,loading:!0,pendingRequestCount:0}),o=e=>{let{children:s}=e,[r,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[f,m]=(0,a.useState)(!0),[x,p]=(0,a.useState)(0);return(0,a.useEffect)(()=>{let e=(0,n.hg)(i.j2,e=>{if(o(e),e){let s=(0,l.H9)(i.db,"users",e.uid),r=(0,l.aQ)(s,e=>{e.exists()?u({id:e.id,...e.data()}):u(null),m(!1)}),t=(0,l.P)((0,l.rJ)(i.db,"friend_requests"),(0,l._M)("toUserId","==",e.uid),(0,l._M)("status","==","pending")),a=(0,l.aQ)(t,e=>{p(e.size)});return()=>{r(),a()}}u(null),p(0),m(!1)});return()=>e()},[]),(0,t.jsx)(d.Provider,{value:{user:r,userDetails:c,loading:f,pendingRequestCount:x},children:s})},c=()=>(0,a.useContext)(d)},8539:(e,s,r)=>{"use strict";r.d(s,{T:()=>i});var t=r(5155),a=r(2115),n=r(9434);let i=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...a})});i.displayName="Textarea"},8856:(e,s,r)=>{"use strict";r.d(s,{E:()=>n});var t=r(5155),a=r(9434);function n(e){let{className:s,...r}=e;return(0,t.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",s),...r})}},9434:(e,s,r)=>{"use strict";r.d(s,{cn:()=>n,f:()=>i});var t=r(2596),a=r(9688);function n(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,a.QP)((0,t.$)(s))}function i(e){if(!e)return"just now";let s=Math.floor((new Date().getTime()-e.getTime())/1e3),r=s/31536e3;return r>1?Math.floor(r)+" years ago":(r=s/2592e3)>1?Math.floor(r)+" months ago":(r=s/86400)>1?Math.floor(r)+" days ago":(r=s/3600)>1?Math.floor(r)+" hours ago":(r=s/60)>1?Math.floor(r)+" minutes ago":Math.floor(s)+" seconds ago"}},9907:(e,s,r)=>{Promise.resolve().then(r.bind(r,6779))}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,3340,3504,6874,618,4810,8441,1684,7358],()=>s(9907)),_N_E=e.O()}]);