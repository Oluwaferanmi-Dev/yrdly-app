(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4135],{10:(e,s,t)=>{"use strict";t.d(s,{$v:()=>j,EO:()=>m,Lt:()=>n,Rx:()=>p,Zr:()=>N,ck:()=>f,r7:()=>h,tv:()=>c,wd:()=>x});var a=t(5155),l=t(2115),r=t(2278),d=t(9434),i=t(285);let n=r.bL,c=r.l9,o=r.ZL,u=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.hJ,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:s})});u.displayName=r.hJ.displayName;let m=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(u,{}),(0,a.jsx)(r.UC,{ref:s,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l})]})});m.displayName=r.UC.displayName;let x=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};x.displayName="AlertDialogHeader";let f=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};f.displayName="AlertDialogFooter";let h=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.hE,{ref:s,className:(0,d.cn)("text-lg font-semibold",t),...l})});h.displayName=r.hE.displayName;let j=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.VY,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...l})});j.displayName=r.VY.displayName;let p=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.rc,{ref:s,className:(0,d.cn)((0,i.r)(),t),...l})});p.displayName=r.rc.displayName;let N=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.ZD,{ref:s,className:(0,d.cn)((0,i.r)({variant:"outline"}),"mt-2 sm:mt-0",t),...l})});N.displayName=r.ZD.displayName},8645:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>k});var a=t(5155),l=t(2115),r=t(5317),d=t(1427),i=t(6104),n=t(8030),c=t(5695),o=t(1394),u=t(285),m=t(6695),x=t(8856),f=t(518),h=t(5318),j=t(3662),p=t(4063),N=t(3896),g=t(320),v=t(7481),b=t(9409),y=t(9166),w=t(7313),C=t(10);let U=()=>(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"p-4 flex items-center gap-4",children:[(0,a.jsx)(x.E,{className:"h-16 w-16 rounded-full"}),(0,a.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,a.jsx)(x.E,{className:"h-5 w-32"}),(0,a.jsx)(x.E,{className:"h-4 w-48"}),(0,a.jsx)(x.E,{className:"h-4 w-40"})]}),(0,a.jsx)(x.E,{className:"h-10 w-28"})]})});function k(){let{user:e,userDetails:s}=(0,n.A)(),t=(0,c.useRouter)(),{toast:x}=(0,v.dj)(),[k,A]=(0,l.useState)([]),[E,q]=(0,l.useState)(!0),[I,_]=(0,l.useState)({state:"all",lga:"all"}),[P,R]=(0,l.useState)([]),[Z,F]=(0,l.useState)("all");(0,l.useEffect)(()=>{if(!e)return;let s=(0,r.P)((0,r.rJ)(i.db,"users"),(0,r._M)("uid","!=",e.uid)),t=(0,r.aQ)(s,e=>{A(e.docs.map(e=>({id:e.id,...e.data()}))),q(!1)}),a=(0,r.P)((0,r.rJ)(i.db,"friend_requests"),(0,r._M)("toUserId","==",e.uid)),l=(0,r.P)((0,r.rJ)(i.db,"friend_requests"),(0,r._M)("fromUserId","==",e.uid)),d=(0,r.aQ)(a,s=>{let t=s.docs.map(e=>({id:e.id,...e.data()}));R(s=>[...s.filter(s=>s.fromUserId===e.uid),...t])}),n=(0,r.aQ)(l,s=>{let t=s.docs.map(e=>({id:e.id,...e.data()}));R(s=>[...s.filter(s=>s.toUserId===e.uid),...t])});return()=>{t(),d(),n()}},[e]);let z=(e,s)=>{_(t=>{let a={...t,[e]:s};return"state"===e&&(a.lga="all"),a})},S=(0,l.useMemo)(()=>{let t=(null==s?void 0:s.blockedUsers)||[];return k.filter(s=>{var a,l,r;if(t.includes(s.uid)||(null==(a=s.blockedUsers)?void 0:a.includes((null==e?void 0:e.uid)||"")))return!1;let d="all"===I.state||(null==(l=s.location)?void 0:l.state)===I.state,i="all"===I.lga||(null==(r=s.location)?void 0:r.lga)===I.lga;return d&&i})},[k,I,s,e]),M=async(s,t)=>{if(s.stopPropagation(),e)try{await (0,r.gS)((0,r.rJ)(i.db,"friend_requests"),{fromUserId:e.uid,toUserId:t.uid,status:"pending",timestamp:(0,r.O5)()}),x({title:"Friend request sent!"})}catch(e){console.error("Error sending friend request: ",e),x({variant:"destructive",title:"Error",description:"Could not send friend request."})}},$=async(s,t)=>{if(s.stopPropagation(),e)try{let e=(0,d.Qg)(i.functions,"acceptfriendrequest");await e({friendRequestId:t.id}),x({title:"Friend request accepted!"})}catch(e){console.error("Error accepting friend request: ",e),x({variant:"destructive",title:"Error",description:"Could not accept friend request."})}},J=async(e,s)=>{e.stopPropagation();let t=(0,r.H9)(i.db,"friend_requests",s.id);await (0,r.mZ)(t,{status:"declined"}),x({title:"Friend request declined."})},L=async(s,t)=>{if(s.stopPropagation(),e)try{await (0,r.c4)(i.db,async s=>{let a=(0,r.H9)(i.db,"users",e.uid),l=(0,r.H9)(i.db,"users",t.uid);s.update(a,{friends:(0,r.C3)(t.uid)}),s.update(l,{friends:(0,r.C3)(e.uid)})}),x({title:"Friend removed."})}catch(e){console.error("Error removing friend: ",e),x({variant:"destructive",title:"Error",description:"Could not remove friend."})}},O=t=>{var a;return(null==s||null==(a=s.friends)?void 0:a.some(e=>e.uid===t.uid))?"friends":P.find(s=>"pending"===s.status&&(s.fromUserId===(null==e?void 0:e.uid)&&s.toUserId===t.uid||s.fromUserId===t.uid&&s.toUserId===(null==e?void 0:e.uid)))?"pending":"none"},V=e=>e?[e.city,e.lga,e.state].filter(Boolean).join(", "):null,D=(0,l.useMemo)(()=>"all"!==I.state&&y.co[I.state]&&y.co[I.state]||[],[I.state]),H=(0,l.useMemo)(()=>{let t=(null==s?void 0:s.blockedUsers)||[];return P.filter(s=>s.toUserId===(null==e?void 0:e.uid)&&"pending"===s.status&&!t.includes(s.fromUserId))},[P,e,s]),Q=(0,l.useMemo)(()=>{let e=(null==s?void 0:s.blockedUsers)||[];return k.filter(t=>{var a;return(null==s||null==(a=s.friends)?void 0:a.some(e=>e.uid===t.uid))&&!e.includes(t.uid)})},[k,s]);return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,a.jsx)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold font-headline",children:"Community"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Connect with other members of your community."})]})}),H.length>0&&(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"p-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Friend Requests"}),(0,a.jsx)("div",{className:"space-y-4",children:H.map(e=>{let s=k.find(s=>s.uid===e.fromUserId);return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"cursor-pointer",onClick:()=>t.push("/users/".concat(e.fromUserId)),children:[(0,a.jsx)("b",{children:(null==s?void 0:s.name)||"Someone"})," wants to be your friend."]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(u.$,{size:"sm",variant:"outline",onClick:s=>$(s,e),children:(0,a.jsx)(f.A,{className:"h-4 w-4"})}),(0,a.jsx)(u.$,{size:"sm",variant:"outline",onClick:s=>J(s,e),children:(0,a.jsx)(h.A,{className:"h-4 w-4"})})]})]},e.id)})})]})}),(0,a.jsxs)(w.tU,{value:Z,onValueChange:F,className:"w-full",children:[(0,a.jsxs)(w.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(w.Xi,{value:"all",children:"All Neighbors"}),(0,a.jsx)(w.Xi,{value:"friends",children:"My Friends"})]}),(0,a.jsxs)(w.av,{value:"all",children:[(0,a.jsxs)("div",{className:"flex w-full md:w-auto md:flex-row gap-2 my-4",children:[(0,a.jsxs)(b.l6,{onValueChange:e=>z("state",e),value:I.state,children:[(0,a.jsx)(b.bq,{className:"w-full md:w-[180px]",children:(0,a.jsx)(b.yv,{placeholder:"Filter by State"})}),(0,a.jsxs)(b.gC,{children:[(0,a.jsx)(b.eb,{value:"all",children:"All States"}),y.gg.map(e=>(0,a.jsx)(b.eb,{value:e,children:e},e))]})]}),(0,a.jsxs)(b.l6,{onValueChange:e=>z("lga",e),value:I.lga,disabled:"all"===I.state,children:[(0,a.jsx)(b.bq,{className:"w-full md:w-[180px]",children:(0,a.jsx)(b.yv,{placeholder:"Filter by LGA"})}),(0,a.jsxs)(b.gC,{children:[(0,a.jsx)(b.eb,{value:"all",children:"All LGAs"}),D.map(e=>(0,a.jsx)(b.eb,{value:e,children:e},e))]})]})]}),E?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(U,{}),(0,a.jsx)(U,{}),(0,a.jsx)(U,{})]}):S.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.map(e=>{let s=O(e);return(0,a.jsx)(m.Zp,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>t.push("/users/".concat(e.uid)),children:(0,a.jsxs)(m.Wu,{className:"p-4 flex items-start gap-4",children:[(0,a.jsxs)(o.eu,{className:"h-16 w-16 border",children:[(0,a.jsx)(o.BK,{src:e.avatarUrl,alt:e.name}),(0,a.jsx)(o.q5,{children:e.name.charAt(0)})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:e.name}),e.location&&(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{children:V(e.location)})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground pt-1",children:e.bio||"No bio yet."})]}),"friends"===s?(0,a.jsxs)(u.$,{size:"sm",onClick:s=>{s.stopPropagation(),t.push("/messages?convId=".concat(e.uid))},children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Message"]}):"pending"===s?(0,a.jsx)(u.$,{size:"sm",disabled:!0,onClick:e=>e.stopPropagation(),children:"Request Sent"}):(0,a.jsxs)(u.$,{size:"sm",onClick:s=>M(s,e),children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Add Friend"]})]})},e.id)})}):(0,a.jsxs)(m.Zp,{className:"text-center p-16",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(N.A,{className:"h-12 w-12 text-muted-foreground"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"No neighbors found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No neighbors match the current filters. Try selecting a different location."})]})]}),(0,a.jsx)(w.av,{value:"friends",children:E?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(U,{}),(0,a.jsx)(U,{}),(0,a.jsx)(U,{})]}):Q.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:Q.map(e=>(0,a.jsx)(m.Zp,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>t.push("/users/".concat(e.uid)),children:(0,a.jsxs)(m.Wu,{className:"p-4 flex items-start gap-4",children:[(0,a.jsxs)(o.eu,{className:"h-16 w-16 border",children:[(0,a.jsx)(o.BK,{src:e.avatarUrl,alt:e.name}),(0,a.jsx)(o.q5,{children:e.name.charAt(0)})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:e.name}),e.location&&(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{children:V(e.location)})]})]}),(0,a.jsxs)(C.Lt,{children:[(0,a.jsx)(C.tv,{asChild:!0,children:(0,a.jsxs)(u.$,{size:"sm",variant:"outline",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Unfriend"]})}),(0,a.jsxs)(C.EO,{children:[(0,a.jsxs)(C.wd,{children:[(0,a.jsx)(C.r7,{children:"Are you sure?"}),(0,a.jsxs)(C.$v,{children:["This will remove ",e.name," from your friends list. This action cannot be undone."]})]}),(0,a.jsxs)(C.ck,{children:[(0,a.jsx)(C.Zr,{onClick:e=>e.stopPropagation(),children:"Cancel"}),(0,a.jsx)(C.Rx,{onClick:s=>L(s,e),children:"Unfriend"})]})]})]})]})},e.id))}):(0,a.jsxs)(m.Zp,{className:"text-center p-16 mt-4",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(N.A,{className:"h-12 w-12 text-muted-foreground"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"No friends yet"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Your friends list is empty. Find neighbors to connect with."})]})})]})]})}},8816:(e,s,t)=>{Promise.resolve().then(t.bind(t,8645))},8856:(e,s,t)=>{"use strict";t.d(s,{E:()=>r});var a=t(5155),l=t(9434);function r(e){let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,l.cn)("animate-pulse rounded-md bg-muted",s),...t})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,3340,3504,1171,3190,8544,4434,3428,3044,2168,8441,1684,7358],()=>s(8816)),_N_E=e.O()}]);